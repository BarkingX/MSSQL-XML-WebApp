
# MSSQL-XML-WebApp

## 概述
*这是一个练习用的XML课设作业,是对SpringBoot框架等多种技术及网页应用编程的初次尝试，最后编辑时间2023年11月16日*
<br>
*网页部分基于[HTML5 Boilerplate](https://html5boilerplate.com/)，示例数据库为MSSQL官方示例数据库*

使用Spring boot开发Java Web应用，实现XML 数据的存储、显示与查询：通过 REST API 和 Ajax 调用实现动态地从 MSSQL 数据库中以XML格式检索数据，通过XSLT转换数据以 HTML表格形式显示检索到的表或视图内容。



## 示例

打开jar压缩包更改BOOT-INF/classes/路径下的applications.properties配置文件，设置目标数据库、登录信息、部署至端口号等其它信息：

运行进入jar所在目录下，cmd或powershell输入java –jar forxml.jar命令运行jar文件（或直接运行目录下的“启动程序.bat”），弹出窗口中无报错且出现以下信息（Started WebApplicationDemo in x.xxx seconds）则证明程序启动成功：

连接至首页`http://localhost:8081/`:
![page](https://github.com/BarkingX/MSSQL-XML-WebApp/assets/94052616/bff2ef1e-d78c-4515-b2ff-5b41e4d267d3)
最顶端显示四个下拉菜单，选择表/视图将在下面的表格显示区域显示出对应表/视图中的数据，表头显示格式为`[catalog].[schema].[table]`。
初次加载时，默认显示第一个目录下第一个模式的第一个表（若该模式无表，则显示第一个视图）。
若某表/视图中无数据，表格区域显示红色提示。

## 使用的技术

- **框架：** Spring Boot

- Spring Boot是一个用于开发Java Web应用的强大框架。它基于Spring框架，通过提供默认配置和自动配置，减少了开发者在项目配置上的繁琐工作。开发者不再需要花费大量时间来调整各种配置文件，而可以专注于核心业务逻辑的实现，使得Java应用的开发变得更加轻松和高效。

- **Web 技术：** Ajax, REST API

- Ajax是一种在无需重新加载整个页面的情况下，通过后台异步加载数据的技术。它能够提升用户体验，使用户在不刷新页面的情况下获取最新数据。

  > REST API是一种基于HTTP协议进行数据交互的架构风格。通过使用RESTful风格的API，可以实现轻量级、灵活且易于扩展的Web服务，有助于前后端之间的通信和数据交换。

- **数据库：** MSSQL

- MSSQL数据库在处理XML数据方面提供了强大的支持。它支持将XML数据存储在数据库中，并提供了丰富的XML查询和处理功能。MSSQL还提供了 'FOR XML' 查询选项，可以将查询结果直接转换为XML格式，方便数据的传输和处理。

- **数据库连接：** JDBC

- JDBC（Java Database Connectivity）是Java中用于与数据库建立连接和执行SQL语句的标准API。它提供了一种通用的方式来访问各种关系型数据库，包括MSSQL。通过JDBC，开发者可以使用标准的Java代码来连接MSSQL数据库，执行SQL语句，并获取结果。JDBC的简单性和广泛支持使其成为Java应用中最常用、最基本的数据库连接方式之一。虽然还有其他高级的数据库连接池技术和ORM框架，但JDBC作为基础的连接方式在简单应用场景中仍然是一种常见选择。

- **数据转换：** XML, XSLT

- XML（通过 'FOR XML' 查询）是一种标记语言，用于在不同系统之间进行数据交换。在数据库中，可以使用 'FOR XML' 查询将查询结果直接以XML格式返回，方便数据的传输和处理。

  > XSLT（用于 XML 到 HTML 的转换）是一种用于将XML文档转换为其他格式的技术。在Web应用中，XSLT常用于将数据库中的XML数据转换为HTML格式，以便在前端进行展示。

## 功能

### 初始页面加载

- Ajax 调用通过 JDBC 连接到 MSSQL 数据库上的 REST API。

- 检索的数据动态填充选择元素：目录、模式、表、视图。

### 选择元素的动态填充

- **目录：** 直接从数据库元数据派生而来。

- **模式：** 依赖于所选择的目录。

- **表和视图：** 基于目录和模式的选择。

### 显示表/视图内容

- 当选择表或视图时，会向 REST API 中的指定端点发出 Ajax 调用。

- 通过 'FOR XML' 从数据库中检索 XML 数据，然后使用 XSLT 将其转换为 HTML 格式。

## 工作流程

1.  用户连接到首页。

2.  Ajax 调用通过 JDBC 连接到 MSSQL 数据库。

3.  使用检索的数据动态填充选择元素。

4.  根据选择的表/视图显示 HTML 格式的内容。

## 优点

- **无缝数据交换：** Ajax 实现实时通讯。

- **互动式用户体验：** 实时更新，根据动态数据库内容。

- **高效数据检索：** 利用 REST API 实现数据检索和 HTML 呈现的优化。

## API 文档

### REST 控制器文档

#### 概述

`AjaxController` 类作为网页应用程序中处理 AJAX 请求的 REST 控制器。它管理前端与 MSSQL 数据库之间的通讯。

#### 功能

控制器协调数据库到 HTML 的数据转换，并管理 `DatabaseService` 的目录和模式信息的设置。

#### 端点

##### 1. `GET /api/toHtmlTable`

- **描述：** 返回指定表名的 HTML 表示。

- 参数：

    - `tableName`（请求参数）：要转换为 HTML 的表名。

- 功能：

    - 创建 `Table` 对象，并检索指定表的列名。

    - 使用 `DatabaseService` 查询基于表的 XML 数据。

    - 使用 `HtmlTransformer` 和 `XsltGenerator` 将 XML 数据转换为 HTML 格式。

##### 2. `GET /api/getCatalogSchemasMap`

- **描述：** 检索目录名称及其对应的模式名称的映射。

- 功能：

    - 使用 `DatabaseService` 检索并返回可用目录名称和关联的模式名称的映射。

##### 3. `GET /api/getSchemaTablesMap`

- **描述：** 检索当前目录中模式名称及其对应的表名称的映射。

- 功能：

    - 使用 `DatabaseService` 检索并返回当前目录中模式名称及其对应的表名称的映射。

##### 4. `GET /api/getSchemaViewsMap`

- **描述：** 检索当前目录中模式名称及其对应的视图名称的映射。

- 功能：

    - 使用 `DatabaseService` 检索并返回当前目录中模式名称及其对应的视图名称的映射。

##### 5. `POST /api/setCatalog`

- **描述：** 为数据库服务设置目录名称。

- 参数：

    - `catalogName`（请求参数）：要设置的目录名称。

- 功能：

    - 使用提供的参数在 `DatabaseService` 中设置目录名称。

##### 6. `POST /api/setSchema`

- **描述：** 为数据库服务设置模式名称。

- 参数：

    - `schemaName`（请求参数）：要设置的模式名称。

- 功能：

    - 使用提供的参数在 `DatabaseService` 中设置模式名称。

## 实验步骤

从main函数、若干"magic number"组成的简单程序，到普通的模块化Java项目，再到基于Spring Boot框架的Java Web项目，本次实验的步骤基本符合常规软件开发的一般流程：从需求分析到软件测试。

实验中，我依次解决了以下两个主要任务：

1.  **XML转换**：使用XSLT将XML转换成HTML；

2.  **可视化**：将转换后的结果可视化展现。

在这两个任务中各自存在着不同程度的难点：

在查询数据库元数据，以XML格式获取数据的时候，我遇到了数据库中的个别数据格式不支持xml格式、常规地使用`getString()`无法获取完整查询结果、数据库名称中某些特殊字符如空格，在xml中属于无效名称、且涉及这些名称的查询语句需用中括号`[]`包围等问题。

这一过程中，我认为最关键的部分就是确定**XML的结构**。一旦XML的结构确定了，生成对应的XSLT的难度将大大降低，生成的XSLT可以实现极其简单，但应对能力极强的效果。对于这一关键问题，我在多次观察测试不同`FOR XML`子句模式的输出结果后，发现`FOR XML PATH, ROOT`的结果最为理想：一个以`root`为根元素，以`row`为每条记录的包围标签，表中的各属性以`列名`为标签，以每条记录在对应属性下的值为`列名`元素内的文本。这样的结构使得XSLT模块只需要一个参数：该表对应的列名集合，就能生成一个将对应表转换成html表格的XSLT文档。

在确定可视化方式时，我基本面临着**桌面应用**和**网页应用**两种选择：前者可以用较为熟悉的Swing写用户图形界面，后者需要拥抱新技术。考虑到程序最终的输出结果是转换后的html等因素，我选择使用Spring Boot作为基础框架搭建Java Web应用。在针对性学习了相关技术一段时间后，我凭借反复测试，最终达到了理想的结果，而这一过程遇到的困难更是数不胜数。

探索学习网页应用开发的途中，我发现了**Ajax**和**REST API**两项技术，二者结合可以达到前后端高效的无缝数据交换。这一特性十分符合我的理想需求，因此我在这次实验中我使用了这两项技术，实际效果也很让我满意。

Figure 1 代码结构树

Figure 2 UML图

## 实验总结

本次实验我将重心放在了代码的优化、结构的调整、以及对新技术的探索学习等方面，效果也很不错。

在XSLT方面我清晰地认识到完全没能发掘XSLT的全部力量，因为我只使用到了最最基础的部分，对无论是进阶技巧还是新特性都没有涉及，不过也因此实现了用最少最简单的代码实现尽可能多且健壮的功能的效果。

在数据库连接方面，实际上在探索学习的过程中，我发现了还有JPA等等超乎我想象的多的数据库连接方式，它们各自有着许多我觉着很有用的特性。但由于此次实验的重心不在这点，我使用了最基础的JDBC连接数据库，希望以后有机会再尝试那些新技术。

在数据库互动方面，由于实验没有要求，以及我对此网页应用的定位不在于此，常规的增删改查四大操作我只实现了查的功能。并且查也只是最基础的普通单表查询，没有例如条件查询、连接查询等等复杂查询操作——我的查询SQL语句简陋到几乎等同于`SELECT * FROM table_name`。为弥补这一缺陷，我在应用开发已经完成后，把原本的表查询拓展为基本表查询和视图查询。这样可以通过使用其他方式在数据库中定义复杂查询的视图，使用网页应用查询视图来间接实现复杂表查询，但很明显这种方式有着很大的局限性。

总体来说，本次实验超额完成了开始之前我对实验的设想，达到了我自己较为满意的效果。如果还有时间和精力，除了上述的种种遗憾，我认为还可以加入缓存和多并发等机制来完善、丰富这一网页应用。
